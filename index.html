<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DevSpark AI – Mentor Edition</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Space+Grotesk:wght@300;500;700&display=swap');

:root{
  --bg1:#020617;
  --bg2:#0f172a;
  --glass:rgba(15,23,42,.75);
  --border:rgba(255,255,255,.08);
  --accent:#22d3ee;
  --text:#f8fafc;
  --sub:#94a3b8;
}

body{
  font-family:'Outfit',sans-serif;
  background:radial-gradient(circle at top left,var(--bg1),var(--bg2));
  color:var(--text);
  overflow:hidden;
}

.font-mono{font-family:'Space Grotesk',monospace}

.glass{
  background:var(--glass);
  backdrop-filter:blur(18px);
  border:1px solid var(--border);
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}

input,select,textarea{
  background:rgba(0,0,0,.35);
  border:1px solid var(--border);
  color:white;
}
</style>
</head>

<body class="h-screen w-screen flex">

<!-- SIDEBAR -->
<aside class="w-80 hidden md:flex p-4">
  <div class="glass rounded-3xl w-full flex flex-col overflow-hidden">
    <div class="p-6 border-b border-white/10 flex items-center gap-4">
      <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
        <i class="fa-solid fa-brain text-white text-2xl"></i>
      </div>
      <div>
        <h1 class="font-black text-xl">Dev<span class="text-cyan-400">Spark</span></h1>
        <p class="text-xs font-mono text-slate-400">MENTOR EDITION</p>
      </div>
    </div>

    <div class="p-4 space-y-3">
      <button onclick="switchView('generator')" class="w-full bg-cyan-600 py-3 rounded-xl font-bold">
        <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> Generator
      </button>
      <button onclick="switchView('mentor')" class="w-full glass py-3 rounded-xl font-bold">
        <i class="fa-solid fa-user-graduate mr-2"></i> Mentor
      </button>
    </div>

    <div class="px-4 text-xs text-slate-400 uppercase tracking-wider">History</div>
    <div id="historyList" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
  </div>
</aside>

<!-- MAIN -->
<main class="flex-1 relative overflow-hidden">

<!-- GENERATOR VIEW -->
<section id="view-generator" class="h-full overflow-y-auto p-8">
  <div class="max-w-4xl mx-auto space-y-12 mt-12">

    <div class="text-center">
      <h1 class="text-7xl font-black">CREATE.</h1>
      <p class="font-mono tracking-widest text-cyan-400">AI PROJECT ARCHITECT</p>
    </div>

    <div class="glass p-10 rounded-3xl grid md:grid-cols-2 gap-8">
      <div>
        <label class="text-xs uppercase text-slate-400">Tech Stack</label>
        <input id="stackInput" class="w-full mt-2 p-4 rounded-xl font-mono" placeholder="React, Python, Flutter">
      </div>
      <div>
        <label class="text-xs uppercase text-slate-400">Domain</label>
        <input id="domainInput" class="w-full mt-2 p-4 rounded-xl" placeholder="AI / Healthcare / SaaS">
      </div>
      <div>
        <label class="text-xs uppercase text-slate-400">Skill Level</label>
        <select id="levelInput" class="w-full mt-2 p-4 rounded-xl">
          <option>Beginner</option>
          <option>Intermediate</option>
          <option>Advanced</option>
        </select>
      </div>
      <div class="flex items-end">
        <button onclick="generateProject()" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-4 rounded-xl font-bold">
          Generate Project
        </button>
      </div>
    </div>

    <!-- RESULT -->
    <div id="resultBox" class="hidden glass p-10 rounded-3xl space-y-6">
      <h2 id="resTitle" class="text-4xl font-black"></h2>
      <p id="resDesc" class="text-slate-300 text-lg"></p>

      <div>
        <h3 class="text-cyan-400 font-bold mb-2">Tech Stack</h3>
        <div id="resStack" class="flex flex-wrap gap-2"></div>
      </div>

      <div>
        <h3 class="text-cyan-400 font-bold mb-2">Roadmap</h3>
        <div id="resRoadmap" class="prose prose-invert max-w-none"></div>
      </div>

      <div>
        <h3 class="text-cyan-400 font-bold mb-2">Mentor Prompt</h3>
        <textarea id="resPrompt" class="w-full h-40 p-4 rounded-xl font-mono text-xs"></textarea>
      </div>
    </div>

  </div>
</section>

<!-- MENTOR VIEW -->
<section id="view-mentor" class="hidden h-full overflow-y-auto p-12">
  <div class="max-w-5xl mx-auto space-y-12">

    <div class="text-center">
      <h1 class="text-6xl font-black">Dr. Jitendra Prajapat</h1>
      <p class="font-mono text-cyan-400 uppercase tracking-widest mt-2">
        Mentor • AI/ML Researcher • Cybersecurity Expert
      </p>
    </div>

    <div class="glass p-10 rounded-3xl text-lg leading-relaxed text-slate-300 space-y-4">
      <p>
        I mentor students to build systems that survive real-world complexity.
        My work bridges academia, industry infrastructure, AI research, and social impact.
      </p>
      <p>
        From hospital IT systems with zero downtime to AI-driven tuberculosis diagnosis,
        my focus is on technology that matters.
      </p>
      <p>
        I do not prepare students for exams — I prepare them for responsibility.
      </p>
    </div>

  </div>
</section>

</main>
<script>
/* ===========================
   GLOBAL STATE
=========================== */
let API_KEY = localStorage.getItem("gemini_key") || "";
let MODEL = "gemini-1.5-flash";
let history = JSON.parse(localStorage.getItem("devspark_history") || "[]");

/* ===========================
   VIEW SWITCHING
=========================== */
function switchView(view){
  document.getElementById("view-generator").classList.toggle("hidden", view !== "generator");
  document.getElementById("view-mentor").classList.toggle("hidden", view !== "mentor");
}

/* ===========================
   HISTORY RENDER (FIXED)
=========================== */
function renderHistory(){
  const list = document.getElementById("historyList");
  if(!history.length){
    list.innerHTML = `<div class="text-slate-500 text-xs text-center mt-6">No projects yet</div>`;
    return;
  }

  list.innerHTML = history.map(item => `
    <div onclick="loadHistory(${item.id})"
         class="glass p-3 rounded-xl cursor-pointer hover:border-cyan-500 border border-transparent">
      <div class="font-bold text-sm truncate">${item.title}</div>
      <div class="text-xs text-slate-400 truncate">${item.domain}</div>
    </div>
  `).join("");
}

/* ===========================
   LOAD HISTORY ITEM (FIXED)
=========================== */
function loadHistory(id){
  const project = history.find(h => h.id === id);
  if(!project) return alert("Project not found");
  renderResult(project);
  switchView("generator");
}

/* ===========================
   GEMINI GENERATION
=========================== */
async function generateProject(){
  if(!API_KEY){
    API_KEY = prompt("Enter your Google Gemini API Key");
    if(!API_KEY) return;
    localStorage.setItem("gemini_key", API_KEY);
  }

  const stack = document.getElementById("stackInput").value || "Modern Tech Stack";
  const domain = document.getElementById("domainInput").value || "General Application";
  const level = document.getElementById("levelInput").value;

  const prompt = `
Act as a senior software architect and mentor.
Create ONE UNIQUE project idea.

User Level: ${level}
Domain: ${domain}
Tech Stack: ${stack}

Return STRICT JSON ONLY (no markdown, no explanation):

{
  "title": "Project title",
  "description": "2–3 line summary",
  "tech_stack": ["item1","item2"],
  "roadmap": "Markdown roadmap",
  "mentor_prompt": "How a mentor would guide the student step-by-step"
}
`;

  try{
    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          contents:[{ parts:[{ text: prompt }] }]
        })
      }
    );

    const data = await res.json();
    if(data.error) throw new Error(data.error.message);

    let text = data.candidates[0].content.parts[0].text
      .replace(/```json|```/g,"")
      .trim();

    const project = JSON.parse(text);

    const saved = {
      ...project,
      id: Date.now(),
      domain,
      createdAt: new Date().toISOString()
    };

    history.unshift(saved);
    history = history.slice(0,10);
    localStorage.setItem("devspark_history", JSON.stringify(history));

    renderResult(saved);
    renderHistory();

  } catch(err){
    console.error(err);
    alert("Generation failed. Check API key or model availability.");
  }
}

/* ===========================
   RENDER RESULT
=========================== */
function renderResult(p){
  document.getElementById("resultBox").classList.remove("hidden");

  document.getElementById("resTitle").innerText = p.title;
  document.getElementById("resDesc").innerText = p.description;

  document.getElementById("resStack").innerHTML =
    p.tech_stack.map(t =>
      `<span class="px-3 py-1 rounded-lg bg-slate-800 text-xs font-mono">${t}</span>`
    ).join("");

  document.getElementById("resRoadmap").innerHTML = marked.parse(p.roadmap);

  document.getElementById("resPrompt").value = p.mentor_prompt;
}

/* ===========================
   INIT
=========================== */
renderHistory();
</script>
