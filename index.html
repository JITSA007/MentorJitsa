<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DevSpark AI – Mentor Edition</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:radial-gradient(circle at top left,#020617,#0f172a);
  color:#f8fafc;
  overflow:hidden;
}
.glass{
  background:rgba(15,23,42,.75);
  backdrop-filter:blur(18px);
  border:1px solid rgba(255,255,255,.08);
}
input,select,textarea{
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.1);
  color:white;
}
</style>
</head>

<body class="h-screen w-screen flex">

<!-- SIDEBAR -->
<aside class="w-80 hidden md:flex p-4">
  <div class="glass rounded-3xl w-full flex flex-col">
    <div class="p-6 border-b border-white/10 font-bold text-xl">
      Dev<span class="text-cyan-400">Spark</span>
    </div>

    <div class="p-4 space-y-2">
      <button onclick="switchView('generator')" class="w-full bg-cyan-600 py-3 rounded-xl font-bold">Generator</button>
      <button onclick="switchView('mentor')" class="w-full glass py-3 rounded-xl font-bold">Mentor</button>
      <button onclick="openSettings()" class="w-full glass py-3 rounded-xl font-bold">Settings</button>
    </div>

    <div class="px-4 text-xs text-slate-400 uppercase">History</div>
    <div id="historyList" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
  </div>
</aside>

<!-- MAIN -->
<main class="flex-1 overflow-y-auto p-8">

<!-- GENERATOR -->
<section id="view-generator">
  <div class="max-w-4xl mx-auto space-y-8">

    <h1 class="text-6xl font-black text-center">CREATE.</h1>

    <div class="glass p-8 rounded-3xl grid md:grid-cols-2 gap-6">
      <input id="stackInput" placeholder="Tech Stack (React, Python)" class="p-4 rounded-xl">
      <input id="domainInput" placeholder="Domain (AI, Healthcare)" class="p-4 rounded-xl">
      <select id="levelInput" class="p-4 rounded-xl">
        <option>Beginner</option>
        <option>Intermediate</option>
        <option>Advanced</option>
      </select>
      <button onclick="generateProject()" class="bg-gradient-to-r from-cyan-600 to-blue-600 py-4 rounded-xl font-bold">
        Generate Project
      </button>
    </div>

    <div id="resultBox" class="hidden glass p-8 rounded-3xl space-y-4">
      <h2 id="resTitle" class="text-3xl font-black"></h2>
      <p id="resDesc" class="text-slate-300"></p>

      <div id="resStack" class="flex gap-2 flex-wrap"></div>
      <div id="resRoadmap"></div>

      <textarea id="resPrompt" class="w-full h-40 p-3 rounded-xl text-xs"></textarea>
    </div>

  </div>
</section>

<!-- MENTOR -->
<section id="view-mentor" class="hidden max-w-4xl mx-auto py-16 space-y-6">
  <h1 class="text-5xl font-black text-center">Dr. Jitendra Prajapat</h1>
  <p class="text-center text-cyan-400">AI Researcher • Cybersecurity Expert • Mentor</p>

  <div class="glass p-8 rounded-3xl text-slate-300 leading-relaxed">
    I mentor students to build systems that survive real-world complexity —
    from healthcare AI to secure enterprise systems.
  </div>

  <div class="text-center">
    <a
      href="https://wa.me/919664301637?text=Hello%20Dr.%20Jitendra,%20I%20would%20like%20mentorship%20guidance."
      target="_blank"
      class="bg-green-500 px-8 py-4 rounded-xl font-bold inline-block">
      WhatsApp Mentor
    </a>
  </div>
</section>

</main>

<!-- SETTINGS -->
<div id="settingsModal" class="fixed inset-0 hidden bg-black/80 flex items-center justify-center">
  <div class="glass p-6 rounded-2xl w-96 space-y-3">
    <input id="apiKeyInput" placeholder="Paste Gemini API Key" class="p-3 rounded-xl w-full">
    <button onclick="fetchModels()" class="bg-cyan-600 w-full py-2 rounded-xl">Fetch Models</button>
    <select id="modelSelect" class="p-3 rounded-xl w-full"></select>
    <button onclick="saveSettings()" class="bg-green-600 w-full py-2 rounded-xl font-bold">Save</button>
  </div>
</div>

<script>
let API_KEY = localStorage.getItem("gemini_key") || "";
let MODEL = localStorage.getItem("gemini_model") || "gemini-1.5-flash";
let history = JSON.parse(localStorage.getItem("devspark_history") || "[]");

/* ---------- Views ---------- */
function switchView(v){
  viewGenerator.classList.toggle("hidden", v!=="generator");
  viewMentor.classList.toggle("hidden", v!=="mentor");
}

/* ---------- Settings ---------- */
function openSettings(){ settingsModal.classList.remove("hidden") }
function saveSettings(){
  API_KEY = apiKeyInput.value.trim();
  MODEL = modelSelect.value;
  localStorage.setItem("gemini_key",API_KEY);
  localStorage.setItem("gemini_model",MODEL);
  settingsModal.classList.add("hidden");
}

async function fetchModels(){
  const key = apiKeyInput.value.trim();
  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
  const data = await res.json();
  const models = data.models
    .filter(m=>m.supportedGenerationMethods?.includes("generateContent"))
    .map(m=>m.name.replace("models/",""));
  modelSelect.innerHTML = models.map(m=>`<option>${m}</option>`).join("");
}

/* ---------- History ---------- */
function renderHistory(){
  historyList.innerHTML = history.map(h=>`
    <div onclick="loadHistory(${h.id})" class="glass p-2 rounded-xl cursor-pointer">
      <div class="font-bold">${h.title}</div>
      <div class="text-xs text-slate-400">${h.domain}</div>
    </div>`).join("");
}
renderHistory();

function loadHistory(id){
  const p = history.find(x=>x.id===id);
  if(p) renderResult(p);
}

/* ---------- Generation ---------- */
async function generateProject(){
  if(!API_KEY) return openSettings();

  const stack = stackInput.value || "Modern Stack";
  const domain = domainInput.value || "General";
  const level = levelInput.value;

  const prompt = `
Return ONLY valid JSON:
{
 "title":"Project Title",
 "description":"2 line summary",
 "tech_stack":["Tech1","Tech2"],
 "roadmap":"Markdown roadmap",
 "mentor_prompt":"Mentor guidance"
}
`;

  const res = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,
    {
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
    }
  );

  const data = await res.json();
  const text = data.candidates[0].content.parts[0].text.replace(/```/g,"");
  const p = JSON.parse(text);

  p.id = Date.now();
  p.domain = domain;

  history.unshift(p);
  localStorage.setItem("devspark_history",JSON.stringify(history));

  renderHistory();
  renderResult(p);
}

function renderResult(p){
  resultBox.classList.remove("hidden");
  resTitle.innerText = p.title;
  resDesc.innerText = p.description;
  resStack.innerHTML = p.tech_stack.map(t=>`<span class="bg-slate-800 px-2 py-1 rounded">${t}</span>`).join("");
  resRoadmap.innerHTML = marked.parse(p.roadmap);
  resPrompt.value = p.mentor_prompt;
}
</script>

</body>
</html>
